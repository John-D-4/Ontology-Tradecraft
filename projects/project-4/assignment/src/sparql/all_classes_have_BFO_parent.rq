PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

SELECT DISTINCT ?class ?label ?directSuperClass ?superClassLabel
WHERE {
  # Find all classes
  ?class rdf:type owl:Class .
  
  # Get labels
  OPTIONAL { ?class rdfs:label ?label }
  
  # Get direct superclasses
  OPTIONAL {
    ?class rdfs:subClassOf ?directSuperClass .
    ?directSuperClass rdf:type owl:Class .
    OPTIONAL { ?directSuperClass rdfs:label ?superClassLabel }
  }
  
  # Exclude BFO classes and OWL built-ins
  FILTER (!REGEX(STR(?class), "^http://purl.obolibrary.org/obo/BFO_"))
  FILTER (?class != owl:Thing && ?class != owl:Nothing)
  
  # Check that class is NOT connected to BFO hierarchy
  FILTER NOT EXISTS {
    ?class rdfs:subClassOf* ?bfoAncestor .
    FILTER (REGEX(STR(?bfoAncestor), "^http://purl.obolibrary.org/obo/BFO_"))
  }
}
ORDER BY ?class
